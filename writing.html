<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Writing | Kevin Cong</title>
    <link rel="stylesheet" href="style.css" />
</head>

<body>
    <!-- ---------- HEADER ---------- -->
    <header>
        <div class="nav-container">
            <h1><a href="index.html">kevin cong</a></h1>
            <nav>
                <a href="index.html">About</a>
                <a href="projects.html">Projects</a>
                <a href="writing.html" class="active">Writing</a>
            </nav>
        </div>
    </header>

    <!-- ---------- MAIN CONTENT ---------- -->
    <main id="writing">
        <h2>Writing</h2>
        <p>
            a collection of things I have written; partially as a potpourri of thoughts, including a blog,
            random opinions, personal notes, course notes, and technical resources / thoughts.
        </p>

        <section id="personal-notes">
            <h3>Personal Notes: Blog Posts</h3>
            <div id="personal-list"></div>
        </section>

        <section id="technical-writings">
            <h3>Technical Writings: Notes, Resources, etc.</h3>
            <div id="technical-list"></div>
        </section>
    </main>

    <footer>
        <p>Â© 2025 Kevin Cong</p>
    </footer>

    <!-- ---------- SCRIPT ---------- -->
    <script>
        // Helper: create a card for each writing entry
        function createCard(post) {
            const div = document.createElement("div");
            div.className = "writing-item";
            const date = post.date ? `<span class="writing-date">${post.date}</span>` : "";

            let link = "";
            if (post.external_url) {
                link = post.external_url;
            } else if (post.pdf_url) {
                const encodedTitle = encodeURIComponent(post.title);
                const encodedDate = encodeURIComponent(post.date || "");
                const encodedPDF = encodeURIComponent(post.pdf_url || "");
                const encodedDesc = encodeURIComponent(post.detailed_description || "");
                link = `writing/post_template.html?title=${encodedTitle}&date=${encodedDate}&pdf=${encodedPDF}&desc=${encodedDesc}`;
            } else if (post.doc_url) {
                const encodedTitle = encodeURIComponent(post.title);
                const encodedDate = encodeURIComponent(post.date || "");
                const encodedDoc = encodeURIComponent(post.doc_url || "");
                const encodedDesc = encodeURIComponent(post.detailed_description || "");
                link = `writing/post_template.html?title=${encodedTitle}&date=${encodedDate}&doc=${encodedDoc}&desc=${encodedDesc}`;
            }

            div.innerHTML = `
                ${date}
                <h3><a href="${link}" target="_blank">${post.title}</a></h3>
                <p>${post.description || ""}</p>
            `;
            return div;
        }

        // Load a JSON file and populate its container. Remove section if empty.
        function loadJSON(path, containerId, sectionId) {
            fetch(path)
                .then(res => res.json())
                .then(posts => {
                    const container = document.getElementById(containerId);
                    const section = document.getElementById(sectionId);

                    // Sort posts by date descending
                    posts.sort((a, b) => new Date(b.date) - new Date(a.date));

                    // Filter valid posts (some might be blank placeholders)
                    const validPosts = posts.filter(p => p.title && (p.external_url || p.pdf_url || p.doc_url));

                    if (validPosts.length === 0) {
                        // Remove section entirely if empty
                        section.remove();
                        return;
                    }

                    // Otherwise render normally
                    validPosts.forEach(post => container.appendChild(createCard(post)));
                })
                .catch(err => {
                    console.error(`Error loading ${path}:`, err);
                    const section = document.getElementById(sectionId);
                    section.remove(); // If fetch fails, remove section too
                });
        }

        // Load both sections
        loadJSON("assets/writing_personal.json", "personal-list", "personal-notes");
        loadJSON("assets/writing_technical.json", "technical-list", "technical-writings");
    </script>
</body>

</html>